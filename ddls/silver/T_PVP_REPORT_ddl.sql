CREATE TABLE IF NOT EXISTS $$unity_catalog_name.$$schema_name.$$delta_table_name (
PVP_PARTICIPANT_ID BIGINT,
PVP_PARTICIPATION_FLAG BOOLEAN,
COMMITTED_LOP_LOCS STRING,
PVP_ENTITY_TYPE STRING,
PVP_340B_ID STRING,
PVP_PARENT_340B_ID STRING,
HRSA_TERM_CODE STRING,
HRSA_TERM_DATE INTEGER,
PVP_MEMBER_NAME STRING,
PVP_ADDRESS_HEADER STRING,
PVP_ADDRESS_LINE_1 STRING,
PVP_ADDRESS_LINE_2 STRING,
PVP_CITY STRING,
PVP_STATE STRING,
PVP_ZIP_CODE BIGINT,
PVP_ZIP_CODE_EXT BIGINT,
HRSA_MEMBER_DATE INTEGER,
PVP_EFFECTIVE_DATE INTEGER,
PVP_EXPIRATION_DATE INTEGER,
HIN_NUMBER STRING,
COVERED_ENTITY_DEA_NUMBER STRING,
PVP_BILLING_PARTICIPANT_NAME STRING,
PVP_BILLING_ADDRESS1 STRING,
PVP_BILLING_ADDRESS2 STRING,
PVP_BILLING_CITY STRING,
PVP_BILLING_STATE STRING,
PVP_BILLING_ZIP BIGINT,
PVP_BILLING_ZIP2 BIGINT,
PVP_SHIPPING_PARTICIPANT_NAME STRING,
PVP_SHIPPING_ADDRESS1 STRING,
PVP_SHIPPING_ADDRESS2 STRING,
PVP_SHIPPING_CITY STRING,
PVP_SHIPPING_STATE STRING,
PVP_SHIPPING_ZIP STRING,
PVP_SHIPPING_ZIP2 STRING,
PRIME_VENDOR_CONTACT1_NAME STRING,
PRIME_VENDOR_CONTACT1_EMAIL STRING,
PRIME_VENDOR_CONTACT1_TITLE STRING,
PRIME_VENDOR_CONTACT1_TELEPHONE_NUMBER STRING,
PRIME_VENDOR_CONTACT2_NAME STRING,
PRIME_VENDOR_CONTACT2_EMAIL STRING,
PRIME_VENDOR_CONTACT2_TITLE STRING,
PRIME_VENDOR_CONTACT2_TELEPHONE STRING,
PRIME_VENDOR_CONTACT3_NAME STRING,
PRIME_VENDOR_CONTACT3_EMAIL STRING,
PRIME_VENDOR_CONTACT3_TITLE STRING,
PRIME_VENDOR_CONTACT3_TELEPHONE STRING,
ENTITY_MEDICAID_NUMBER STRING,
ENTITY_GRANT_NUMBER STRING,
ALT_METHODS BOOLEAN,
PVP_SHIPPING_HIN STRING,
ORIGINAL_PVP_PARTICIPANT_ID STRING,
_rescued_data STRING COMMENT 'Rescued Data',
ADF_RUN_ID STRING COMMENT 'ID for specific pipeline run loaded from landing. This run_id gets generated when the records gets loaded from source to landing',
ADF_JOB_ID STRING COMMENT 'ID of the trigger that invokes the pipeline. This job_id gets generated when the records gets loaded from source to landing',
RECORD_LOAD_TIME TIMESTAMP DEFAULT current_timestamp COMMENT 'This is the default generated column using current timestamp when the record is loaded in the table',
INPUT_FILE_NAME STRING COMMENT 'This is extracted from the input file name of source',
DATABRICKS_RUN_ID STRING COMMENT 'Run ID of the Databricks job run. This gets generated from the bronze notebook run',
DATABRICKS_JOB_ID STRING COMMENT 'Job ID of the Databricks job run. This gets generated from the bronze notebook run',
INSERT_TS TIMESTAMP COMMENT 'This is the default generated column using current timestamp when the record is loaded in the table',
UPDATE_TS TIMESTAMP COMMENT 'This is the default generated column using current timestamp when the record is loaded in the table',
DATE_PART DATE GENERATED ALWAYS AS (DATE(RECORD_LOAD_TIME)) COMMENT 'This is autogenerated from date part of the RECORD_LOAD_TIME column',
HOUR_PART INT GENERATED ALWAYS AS (HOUR(RECORD_LOAD_TIME)) COMMENT 'This is autogenerated from hour part of the RECORD_LOAD_TIME column'
) 
USING DELTA PARTITIONED BY (DATE_PART, HOUR_PART) LOCATION '$$delta_table_location' 
TBLPROPERTIES (
  'delta.feature.allowColumnDefaults' = 'supported',
  'delta.feature.appendOnly' = 'supported',
  'delta.feature.invariants' = 'supported',
  'delta.minReaderVersion' = '1',
  'delta.minWriterVersion' = '7',
  'spark.sql.files.ignoreMissingFiles'=true
);

